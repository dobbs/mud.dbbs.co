{
  "version": 3,
  "sources": [
    "changes.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "###\n * Federated Wiki : Changes Plugin\n *\n * Licensed under the MIT license.\n * https://github.com/fedwiki/wiki-plugin-changes/blob/master/LICENSE.txt\n###\n\nescape = (line) ->\n  line\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n\nlistItemHtml = (slug, title)->\n  \"\"\"\n    <li>\n      <a class=\"internal\" href=\"#\" title=\"local\" data-page-name=\"#{slug}\" data-site=\"local\">#{escape title}</a>\n      <button class=\"delete\">âœ•</button>\n    </li>\n  \"\"\"\n\npageBundle = ->\n  bundle = {}\n  length = localStorage.length\n  for i in [0...length]\n    slug = localStorage.key i\n    bundle[slug] = JSON.parse localStorage.getItem slug\n  bundle\n\nconstructor = ($, dependencies={})->\n  localStorage = dependencies.localStorage || window.localStorage\n\n  emit = ($div, item) ->\n    if( localStorage.length == 0 )\n      $div.append( '<ul><p><i>no local changes</i></p></ul>' )\n      return\n\n    $div.append( ul = $('<ul />') )\n    for i in [0...localStorage.length]\n      slug = localStorage.key(i)\n      page = JSON.parse(localStorage.getItem(slug))\n      if page.title?\n        ul.append listItemHtml(slug,page.title)\n    if localStorage.length > 0\n      if item.submit?\n        ul.append \"\"\"<button class=\"submit\">Submit Changes</button>\"\"\"\n      else\n        $div.append \"\"\"\n          <p> Click <i>Export Changes</i> to download changed pages as <i>#{location.hostname}.json</i>.\n          Drag-and-drop this file to import pages elsewhere.</p>\n          <ul><button class=\"export\">Export Changes</button></ul>\n        \"\"\"\n\n  bind = ($div, item) ->\n    $div.on 'click', '.delete', ->\n      slug = $(this).siblings('a.internal').data('pageName')\n      localStorage.removeItem(slug)\n      emit( $div.empty(), item )\n\n    $div.on 'click', '.submit', ->\n      $.ajax\n        type: 'PUT'\n        url: \"/submit\"\n        data:\n          'bundle': JSON.stringify(pageBundle())\n        success: (citation, textStatus, jqXHR) ->\n          wiki.log \"ajax submit success\", citation, textStatus, jqXHR\n          throw new Exception \"Incomplete Submission\" unless citation.type and citation.site\n          pageElement = $div.parents('.page:first')\n          itemElement = $(\"<div />\", class: \"item #{citation.type}\").data('item',citation).attr('data-id', citation.id)\n          itemElement.data 'pageElement', pageElement\n          pageElement.find(\".story\").append(itemElement)\n          wiki.doPlugin itemElement, citation\n          beforeElement = itemElement.prev('.item')\n          before = wiki.getItem(beforeElement)\n          wiki.pageHandler.put pageElement, {item: citation, id: citation.id, type: \"add\", after: before?.id}\n        error: (xhr, type, msg) ->\n          wiki.log \"ajax error callback\", type, msg\n\n    $div.on 'click', '.export', ->\n      anchor = document.createElement('a')\n      document.body.appendChild(anchor)\n      anchor.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(pageBundle())))\n      anchor.setAttribute('download', location.hostname + '.json')\n      anchor.click()\n      document.body.removeChild(anchor)\n\n    $div.dblclick ->\n      bundle = pageBundle()\n      count = _.size(bundle)\n      wiki.dialog \"JSON bundle for #{count} pages\",  $('<pre/>').text(JSON.stringify(bundle, null, 2))\n\n  {\n    emit: emit\n    bind: bind\n  }\n\nwiki.registerPlugin( 'changes', constructor )\n\nmodule.exports = constructor if module?\n"
  ],
  "sourceRoot": ""
}