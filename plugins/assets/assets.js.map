{
  "version": 3,
  "sources": [
    "assets.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nexpand = (text)->\n  text\n    .replace /&/g, '&amp;'\n    .replace /</g, '&lt;'\n    .replace />/g, '&gt;'\n\nignore = (e) ->\n  e.preventDefault()\n  e.stopPropagation()\n\ncontext = ($item) ->\n  sites = [location.host]\n  if remote = $item.parents('.page').data('site')\n    unless remote == location.host\n      sites.push remote\n  journal = $item.parents('.page').data('data').journal\n  for action in journal.slice(0).reverse()\n    if action.site? and not sites.includes(action.site)\n      sites.push action.site\n  sites\n\npost_upload = ($item, item, form) ->\n  $progress = $item.find '.progress-bar'\n\n  tick = (e) ->\n    return unless e.lengthComputable\n    percentComplete = e.loaded / e.total\n    percentComplete = parseInt(percentComplete * 100)\n    $progress.text \"#{percentComplete}%\"\n    $progress.width \"#{percentComplete}%\"\n\n  $.ajax\n    url: '/plugin/assets/upload'\n    type: 'POST'\n    data: form\n    processData: false\n    contentType: false\n    success: ->\n      $item.empty()\n      emit $item, item\n      bind $item, item\n    error: (e) ->\n      console.log 'error', e\n      $progress.text \"upload error: #{e.statusText} #{e.responseText||''}\"\n      $progress.width '100%'\n    xhr: ->\n      xhr = new XMLHttpRequest\n      xhr.upload.addEventListener 'progress', tick, false\n      xhr\n\nget_file = ($item, item, url, success) ->\n  assets = item.text.match(/([\\w\\/-]*)/)[1]\n  filename = url.split('/').reverse()[0]\n  fetch(url).then((response) ->\n    response.blob()\n  ).then((blob) ->\n    file = new File(\n      [blob],\n      filename,\n      { type: blob.type }\n    )\n\n    form = new FormData()\n    form.append 'assets', assets\n    form.append 'uploads[]', file, file.name\n    success form\n  ).catch((e) ->\n    $progress = $item.find '.progress-bar'\n    $progress.text \"Copy error: #{e.message}\"\n    $progress.width '100%'\n  )\n\n\ndelete_file = ($item, item, url) ->\n  file = url.split('/').reverse()[0]\n  assets = item.text\n  $.ajax\n    url: \"/plugin/assets/delete?file=#{file}&assets=#{assets}\"\n    type: 'POST'\n    success: () ->\n      $item.empty()\n      emit $item, item\n      bind $item, item\n    error: (e) ->\n      $progress = $item.find '.progress-bar'\n      $progress.text \"Delete error: #{e.statusText} #{e.responseText||''}\"\n      $progress.width '100%'\n\nfetch_list = ($item, item, $report, assets, remote, assetsData) ->\n  requestSite = if remote? then remote else null\n  assetsURL = wiki.site(requestSite).getDirectURL('assets')\n  if assetsURL is ''\n    $report.text \"site not currently reachable.\"\n    return\n\n  link = (file) ->\n    href = \"#{assetsURL}/#{if assets is '' then \"\" else assets + \"/\"}#{encodeURIComponent file}\"\n    # todo: no action if not logged on\n    act = unless isOwner\n      ''\n    else if remote != location.host\n      '<button class=\"copy\">⚑</button> '\n    else\n      '<button class=\"delete\">✕</button> '\n    \n    \"\"\"<span>#{act}<a href=\"#{href}\" target=_blank>#{expand file}</a></span>\"\"\"\n\n  render = (data) ->\n    assetsData[assets] ||= {}\n    if data.error\n      return $report.text \"no files\" if data.error.code == 'ENOENT'\n      return $report.text \"plugin reports: #{data.error.code}\"\n    files = data.files\n    assetsData[assets][assetsURL] = files\n\n    if files.length == 0\n      return $report.text \"no files\"\n    $report.html (link file for file in files).join \"<br>\"\n\n    $report.find('button.copy').click (e) ->\n      href = $(e.target).parent().find('a').attr('href')\n      get_file $item, item, href, (form) ->\n        post_upload $item, item, form\n\n    $report.find('button.delete').click (e) ->\n      href = $(e.target).parent().find('a').attr('href')\n      delete_file $item, item, href\n\n  trouble = (e) ->\n    $report.text \"plugin error: #{e.statusText} #{e.responseText||''}\"\n\n  $.ajax\n    url: wiki.site(requestSite).getURL('plugin/assets/list')\n    data: {assets}\n    dataType: 'json'\n    success: render\n    error: trouble\n\nemit = ($item, item) ->\n  uploader = ->\n    return '' if $item.parents('.page').hasClass 'remote'\n    \"\"\"\n      <div style=\"background-color:#ddd;\" class=\"progress-bar\" role=\"progressbar\"></div>\n      <center><button class=\"upload\">upload</button></center>\n      <input style=\"display: none;\" type=\"file\" name=\"uploads[]\" multiple=\"multiple\">\n    \"\"\"\n\n  $item.append \"\"\"\n    <div style=\"background-color:#eee;padding:15px; margin-block-start:1em; margin-block-end:1em;\">\n      <dl style=\"margin:0;color:gray\"></dl>\n      #{uploader()}\n    </div>\n  \"\"\"\n\n  assetsData = {}\n  $item.addClass 'assets-source'\n  $item.get(0).assetsData = -> assetsData\n\n  assets = item.text.match(/([\\w\\/-]*)/)[1]\n  for site in context $item\n    $report = $item.find('dl').prepend \"\"\"\n      <dt><img width=12 src=\"#{wiki.site(site).flag()}\"> #{site}</dt>\n      <dd style=\"margin:8px;\"></dd>\n    \"\"\"\n    fetch_list $item, item, $report.find('dd:first'), assets, site, assetsData\n\n\nbind = ($item, item) ->\n  assets = item.text.match(/([\\w\\/-]*)/)[1]\n\n  $item.dblclick -> wiki.textEditor $item, item\n\n  # https://coligo.io/building-ajax-file-uploader-with-node/\n  $button = $item.find '.upload'\n  $input = $item.find 'input'\n\n  $button.click (e) ->\n    $input.click()\n\n  $input.on 'change', (e) ->\n    upload $(this).get(0).files\n\n  $item.on 'dragover', ignore\n  $item.on 'dragenter', ignore\n  $item.on 'drop', (e) ->\n    ignore e\n    upload e.originalEvent.dataTransfer?.files\n\n  upload = (files) ->\n    return unless files?.length\n    form = new FormData()\n    form.append 'assets', assets\n    for file in files\n      form.append 'uploads[]', file, file.name\n    post_upload $item,item,form\n\nwindow.plugins.assets = {emit, bind} if window?\nmodule.exports = {expand} if module?\n"
  ],
  "sourceRoot": ""
}